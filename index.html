<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>分店新地點出攤申請</title>
<style>
  :root{--bg:#f6f7fb;--surface:#fff;--text:#111;--muted:#6b7280;--brand:#111;--border:#e5e7eb}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC",Arial,sans-serif}
  .wrap{max-width:520px;margin:0 auto;padding:20px 14px}
  h1{font-size:20px;text-align:center;margin:8px 0 16px}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.06);margin-bottom:14px}
  label{display:block;font-size:14px;font-weight:600;margin:8px 0 6px}
  input,textarea{width:100%;font-size:16px;padding:12px;border:1px solid var(--border);border-radius:10px}
  textarea{min-height:84px;resize:vertical}
  .row{display:flex;gap:10px}
  .row>*{flex:1}
  button{width:100%;background:var(--brand);color:#fff;font-size:16px;padding:14px;border:none;border-radius:10px;cursor:pointer}
  button:active{opacity:.9}
  .note{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
  .status{margin-top:14px;text-align:center;font-weight:700}
  .bad{color:#dc2626}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#f1f5f9;color:#111;font-size:12px}
  .brand{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:8px}
  .brand img{height:28px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <img src="https://your.cdn/logo.png" alt="logo">
      <div class="pill">啃酥菱角酥｜出攤申請</div>
    </div>
    <h1>分店新地點申請</h1>
    <div class="card">
      <form id="applyForm" autocomplete="on">
        <label>分店名稱</label>
        <input name="分店名稱" required placeholder="例：啃酥菱角酥 竹南站前店" />

        <label>負責人</label>
        <input name="負責人" required placeholder="例：王小明" />

        <div class="row">
          <div>
            <label>電話</label>
            <input name="電話" type="tel" inputmode="tel" required placeholder="09xx-xxx-xxx" />
          </div>
          <div>
            <label>Email</label>
            <input name="Email" type="email" required placeholder="you@example.com" />
          </div>
        </div>

        <label>申請地點</label>
        <textarea name="申請地點" required placeholder="例：苗栗縣竹南鎮○○路夜市 A 區 15 號攤位。請附主辦單位名稱／檔期／電力條件等。"></textarea>

        <div class="row">
          <div>
            <label>出攤日期</label>
            <input name="出攤日期" type="date" required />
          </div>
        </div>

        <label>備註</label>
        <textarea name="備註" placeholder="例：主辦單位檔期至 12/31，備有 110V 電源"></textarea>

        <button type="submit">送出申請</button>
      </form>

      <div id="submitResult" class="status"></div>

      <hr style="margin:16px 0;border:none;border-top:1px solid var(--border)" />

      <div>
        <div class="pill">查詢審核狀態</div>
        <label style="margin-top:10px">申請編號</label>
        <form id="queryForm" class="row" onsubmit="return false;">
          <input id="qid" placeholder="例：KS-1A2B3C4D" />
          <button id="queryBtn">查詢</button>
        </form>
        <div id="queryResult" class="status"></div>
      </div>

      <div class="note">送出後會寄信通知總部；審核完成會寄正式通知到你填寫的 Email。</div>
    </div>
  </div>

<script>
  const WEB_APP_URL = '<<貼上你的 Apps Script Web App URL>>'; // 必改

  const $ = (s)=>document.querySelector(s);
  const form = $('#applyForm');
  const submitResult = $('#submitResult');

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    submitResult.textContent = '送出中…';
    const fd = new FormData(form);
    const data = Object.fromEntries(fd.entries());

    try {
      const res = await fetch(WEB_APP_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(data)
      });
      const json = await res.json();
      if (json.ok) {
        submitResult.innerHTML = `✅ 申請已送出，編號：<b>${json.id}</b>。<br>系統已通知總部，審核完成將寄正式信件給你。`;
        form.reset();
      } else {
        submitResult.innerHTML = `❌ 送出失敗：<span class="bad">${json.error || 'unknown'}</span>`;
      }
    } catch (err) {
      submitResult.innerHTML = `❌ 送出失敗：<span class="bad">${String(err)}</span>`;
    }
  });

  // 查詢狀態
  const queryBtn = $('#queryBtn');
  const qidInput = $('#qid');
  const queryResult = $('#queryResult');

  queryBtn.addEventListener('click', async ()=>{
    const qid = (qidInput.value || '').trim();
    if (!qid) {
      queryResult.textContent = '請輸入申請編號';
      return;
    }
    queryResult.textContent = '查詢中…';
    try {
      const res = await fetch(`${WEB_APP_URL}?id=${encodeURIComponent(qid)}`);
      const json = await res.json();
      if (json.ok) {
        let icon = '⏳';
        if (json.狀態 === '通過') icon = '✅';
        else if (json.狀態 === '不通過') icon = '❌';
        queryResult.innerHTML = `${icon} 審核狀態：<b>${json.狀態}</b>` +
          (json.審核時間 ? `<div class="note">更新時間：${json.審核時間}</div>` : '') +
          (json.審核備註 ? `<div class="note">審核備註：${json.審核備註}</div>` : '');
      } else {
        queryResult.innerHTML = `❌ 查詢失敗：<span class="bad">${json.error}</span>`;
      }
    } catch (err) {
      queryResult.innerHTML = `❌ 查詢失敗：<span class="bad">${String(err)}</span>`;
    }
  });
</script>
</body>
</html>
