<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>分店新地點出攤申請</title>
<style>
  :root{--bg:#f6f7fb;--surface:#fff;--text:#111;--muted:#6b7280;
    --brand:#111;--border:#e5e7eb;--ok:#16a34a;--bad:#dc2626;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC",Arial,sans-serif}
  .wrap{max-width:560px;margin:0 auto;padding:20px 14px}
  .brandbar{display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:10px}
  .brandbar img{height:40px}
  .brandbar .title{font-weight:800;letter-spacing:.1em}
  h1{font-size:20px;text-align:center;margin:6px 0 16px}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.06);margin-bottom:14px}
  label{display:block;font-size:14px;font-weight:600;margin:10px 0 6px}
  input,textarea{width:100%;font-size:16px;padding:12px;border:1px solid var(--border);border-radius:10px;background:#fff}
  textarea{min-height:84px;resize:vertical}
  .row{display:flex;gap:10px}
  .row>*{flex:1}
  .btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:12px 14px;font-size:16px;cursor:pointer}
  .btn-ghost{background:#f1f5f9;color:#111;border:1px dashed var(--border)}
  .status{text-align:center;margin-top:14px;font-weight:700}
  .chip{font-size:12px;border-radius:999px;background:#eef2ff;color:#3730a3;padding:4px 8px}
  .loc{border:1px solid var(--border);border-radius:12px;padding:12px;margin-top:10px;background:#fff}
  .loc .hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .loc .del{background:#fff;border:1px solid var(--border);border-radius:999px;font-size:12px;padding:4px 8px;cursor:pointer}
  .muted{font-size:12px;color:#6b7280}
  footer{margin-top:18px;color:#444}
  footer .legal{font-size:12px;color:#6b7280;line-height:1.6;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <div class="brandbar">
      <img src="https://drive.google.com/uc?export=view&id=14OhrEALBrL1MgfeXlsvI8Qwh_HBcZgxR" alt="LOGO">
      <div class="title">啃酥菱角酥｜出攤申請</div>
    </div>
    <h1>分店新地點申請</h1>

    <div class="card">
      <form id="applyForm">
        <label>分店名稱</label>
        <input name="分店名稱" required placeholder="例：啃酥菱角酥 和美店" />

        <label>負責人</label>
        <input name="負責人" required placeholder="例：王小明" />

        <div class="row">
          <div>
            <label>電話</label>
            <input name="電話" type="tel" required placeholder="09xx-xxx-xxx" />
          </div>
          <div>
            <label>Email</label>
            <input name="Email" type="email" required placeholder="you@example.com" />
          </div>
        </div>

        <label>申請地點（可新增多筆）</label>
        <div id="locations"></div>
        <button id="addLoc" type="button" class="btn-ghost">＋ 新增地點</button>

        <label>整體備註</label>
        <textarea name="備註" placeholder="例：主辦單位檔期至 12/31，備有 110V 電源"></textarea>

        <button class="btn" type="submit" style="margin-top:10px;width:100%">送出申請</button>
      </form>

      <div id="submitResult" class="status"></div>

      <hr style="margin:16px 0">

      <div style="text-align:center">
        <div class="chip">查詢審核狀態</div>
        <form id="queryForm" style="margin-top:10px">
          <input id="qid" placeholder="例：KS-XXXXXX" style="padding:8px;width:200px" />
          <button type="submit" class="btn">查詢</button>
        </form>
        <div id="queryResult" class="status"></div>
        <div class="muted">送出後會寄信通知總部；審核完成會寄正式通知到你填寫的 Email。</div>
      </div>
    </div>

    <footer>
      <div class="legal">
        酥味香企業社 ｜ 統一編號：93428964<br>
        地址：台中市石岡區石岡街61號<br>
        本頁面內容由總部保有修改權利<br>
        © <span id="year"></span> 啃酥菱角酥 All Rights Reserved.
      </div>
    </footer>
  </div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby3X8SIGX7g8sBD25SgsDHamKFgVhcDqxLbmelNvF56HNETo8AjGNxyvK4FZAeCscqSUw/exec";

const locs = document.getElementById("locations");
const addBtn = document.getElementById("addLoc");

function makeLoc(idx){
  const div=document.createElement("div");
  div.className="loc";
  div.innerHTML=`
    <div class="hdr"><b>地點 #${idx}</b><button type="button" class="del">刪除</button></div>
    <label>出攤地點</label>
    <textarea class="place"></textarea>
    <div class="row">
      <div><label>開始日期</label><input type="date" class="start"></div>
      <div><label>結束日期</label><input type="date" class="end"></div>
    </div>
    <label><input type="checkbox" class="undecided"> 日期未定</label>
    <input class="note" placeholder="備註（選填）">
  `;
  div.querySelector(".del").onclick=()=>{div.remove();refreshIdx()};
  div.querySelector(".undecided").onchange=(e)=>{
    div.querySelector(".start").disabled=e.target.checked;
    div.querySelector(".end").disabled=e.target.checked;
  }
  return div;
}
function refreshIdx(){
  [...locs.children].forEach((d,i)=>d.querySelector("b").textContent="地點 #"+(i+1));
}
addBtn.onclick=()=>{locs.appendChild(makeLoc(locs.children.length+1));}
locs.appendChild(makeLoc(1));

document.getElementById("applyForm").onsubmit=async(e)=>{
  e.preventDefault();
  const fd=new FormData(e.target);
  const data=Object.fromEntries(fd.entries());
  const locList=[...locs.children].map(d=>({
    出攤地點:d.querySelector(".place").value.trim(),
    出攤起日:d.querySelector(".start").value,
    出攤迄日:d.querySelector(".end").value,
    日期未定:d.querySelector(".undecided").checked,
    地點備註:d.querySelector(".note").value.trim()
  }));
  data.申請地點=locList[0].出攤地點;
  data.出攤日期=locList[0].日期未定?"未定":(locList[0].出攤起日+"~"+locList[0].出攤迄日);
  data.地點清單=JSON.stringify(locList);

  const res=await fetch(WEB_APP_URL,{method:"POST",body:JSON.stringify(data)});
  const json=await res.json();
  document.getElementById("submitResult").textContent=json.ok?"✅ 已送出 編號:"+json.id:"❌ 失敗:"+json.error;
};

document.getElementById("queryForm").onsubmit=async(e)=>{
  e.preventDefault();
  const id=document.getElementById("qid").value.trim();
  const res=await fetch(WEB_APP_URL+"?id="+encodeURIComponent(id));
  const json=await res.json();
  document.getElementById("queryResult").textContent=json.ok?("狀態:"+json.狀態):"查無資料";
};
document.getElementById("year").textContent=new Date().getFullYear();
</script>
</body>
</html>
